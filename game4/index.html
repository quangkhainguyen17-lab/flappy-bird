<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Flappy Style Game</title>

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:Arial,sans-serif;
}
canvas{
  display:block;
  width:100vw;
  height:100vh;
  touch-action:manipulation;
}
#playersOnline{
  position:fixed;
  top:12px;
  left:12px;
  padding:6px 12px;
  font-size:14px;
  color:#fff;
  background:rgba(0,0,0,.55);
  border-radius:14px;
  z-index:20;
}
.liveDot{
  display:inline-block;
  width:8px;
  height:8px;
  background:red;
  border-radius:50%;
  margin-right:6px;
  animation:pulse 1.2s infinite;
}
@keyframes pulse{0%{opacity:1}50%{opacity:.3}100%{opacity:1}}
</style>
</head>

<body>
<canvas id="game"></canvas>

<div id="playersOnline">
  <span class="liveDot"></span> LIVE · 54632+ người đang chơi
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

/* ===== GAME STATE ===== */
let started = false;
let gameOver = false;
let score = 0;
let frame = 0;

const bird = {
  x: 0,
  y: 0,
  r: 16,
  v: 0,
  g: 0.45,
  jump: -7
};

const pipes = [];
const pipeWidth = 72;
const gap = 165;

/* ===== ỐNG GIỐNG FLAPPY BIRD ===== */
function drawPipe(x, y, h, isTop){
  const g = ctx.createLinearGradient(x, 0, x + pipeWidth, 0);
  g.addColorStop(0,  "#1b8f2e");
  g.addColorStop(0.25,"#35d64a");
  g.addColorStop(0.5, "#9aff57");
  g.addColorStop(0.75,"#35d64a");
  g.addColorStop(1,  "#1b8f2e");

  ctx.fillStyle = g;
  ctx.fillRect(x, y, pipeWidth, h);

  ctx.strokeStyle = "#0e5f1f";
  ctx.lineWidth = 3;
  ctx.strokeRect(x, y, pipeWidth, h);

  // Nắp ống
  const capH = 20;
  const capY = isTop ? y + h - capH : y;

  const gCap = ctx.createLinearGradient(x - 6, 0, x + pipeWidth + 6, 0);
  gCap.addColorStop(0, "#1b8f2e");
  gCap.addColorStop(0.5, "#9aff57");
  gCap.addColorStop(1, "#1b8f2e");

  ctx.fillStyle = gCap;
  ctx.fillRect(x - 6, capY, pipeWidth + 12, capH);
  ctx.strokeRect(x - 6, capY, pipeWidth + 12, capH);
}

/* ===== CONTROL ===== */
addEventListener("click", flap);
addEventListener("touchstart", flap);

function flap(){
  if(!started){
    started = true;
    gameOver = false;
    pipes.length = 0;
    score = 0;
    bird.x = canvas.width * 0.3;
    bird.y = canvas.height / 2;
    bird.v = 0;
  }
  if(!gameOver) bird.v = bird.jump;
}

/* ===== GAME LOOP ===== */
function loop(){
  // Nền trời
  ctx.fillStyle = "#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Chim
  bird.v += bird.g;
  bird.y += bird.v;
  ctx.fillStyle = "#FFD93D";
  ctx.beginPath();
  ctx.arc(bird.x, bird.y, bird.r, 0, Math.PI*2);
  ctx.fill();

  // Tạo ống
  if(started && !gameOver && frame % 90 === 0){
    const top = Math.random() * (canvas.height - gap - 200) + 100;
    pipes.push({ x: canvas.width, top, passed:false });
  }

  // Vẽ & va chạm
  pipes.forEach(p=>{
    p.x -= 3.2;

    drawPipe(p.x, 0, p.top, true);
    drawPipe(p.x, p.top + gap, canvas.height, false);

    if(
      bird.x + bird.r > p.x &&
      bird.x - bird.r < p.x + pipeWidth &&
      (bird.y - bird.r < p.top || bird.y + bird.r > p.top + gap)
    ){
      gameOver = true;
    }

    if(!p.passed && p.x + pipeWidth < bird.x){
      p.passed = true;
      score++;
    }
  });

  // Xóa ống cũ
  for(let i=pipes.length-1;i>=0;i--){
    if(pipes[i].x < -100) pipes.splice(i,1);
  }

  // Điểm
  ctx.fillStyle="#fff";
  ctx.font="32px Arial";
  ctx.fillText(score, canvas.width/2 - 10, 60);

  frame++;
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
  </html>
